<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Переход от IPv4 к IPv6</title>
<link rel="stylesheet" href="bgnet.css" type="text/css">
</head>

<body bgcolor="#ffffff">
<table width="100%" border="0" cellspacing="0"cellpadding="0" class="navtable">
<tr>
<td align="left"><a href="ipstructsdata.html">&lt;&lt;&nbsp;Пред</a></td>
<td align="center"><a href="index.html">Руководство Beej'a по Программированию Сетей</a></td><td align="right"><a href="syscalls.html">След&nbsp;&gt;&gt;</a></td>
</tr></table>


<h2 class="sect1title">4. <a name="ip4to6">Переход от IPv4 к IPv6</a></h2><hr class="mainsecthr"/>


<p><a name="indexId434909-88"></a>Я всего лишь хочу узнать, что нужно поменять в моём коде, чтобы он работал с IPv6! Расскажи мне!</p>

<p>Ладно! Ладно!</p>

<p>Почти всё, что здесь описано, я уже рассказывал, но эта глава содержит краткую версию для нетерпеливых. (Конечно, это не всё, что можно рассказать на эту тему, но это всё, что применимо к данному руководству.)</p>

<ol>

<li>Во-первых, используй <a name="indexId434909-89"></a><a href="syscalls.html#getaddrinfo"><b><tt class="func">getaddrinfo()</tt></b></a> для получения всех <nobr><tt class="type">struct sockaddr</tt></nobr>, вместо того, чтобы формировать структуры вручную. Тогда твой код не будет зависеть от версии IP, что позволит пропустить множество промежуточных шагов.</li>


<li>Если в каком-то месте ты хардкодишь что-то, связанное с версией IP - спрячь этот код в функцию-обёртку.</li>


<li>Замени <tt class="const">AF_INET</tt> на <tt class="const">AF_INET6</tt>.</li>


<li>Замени <tt class="const">PF_INET</tt> на <tt class="const">PF_INET6</tt>.</li>


<li><p>Замени присваивания <tt class="const">INADDR_ANY</tt> на присваивания <tt class="const">in6addr_any</tt>, что означает немного другое:</p>

<pre class="code">struct sockaddr_in sa;
struct sockaddr_in6 sa6;

sa.sin_addr.s_addr = INADDR_ANY;  // use my IPv4 address
sa6.sin6_addr = in6addr_any; // use my IPv6 address</pre>


<p>Также, значение <tt class="const">IN6ADDR_ANY_INIT</tt> может быть использовано для инициализации при создании объекта <nobr><tt class="type">struct in6_addr</tt></nobr> вот так:</p>

<pre class="code">struct in6_addr ia6 = IN6ADDR_ANY_INIT;</pre>

</li>


<li>Вместо <nobr><tt class="type">struct sockaddr_in</tt></nobr> используй <nobr><tt class="type">struct sockaddr_in6</tt></nobr>, убедись что в нужных местах приписал "6" к полям (см. <a href="ipstructsdata.html#structs"><nobr><tt class="type">struct</tt></nobr>ы</a> выше). Не существует поля <i><tt class="var">sin6_zero</tt></i>.</li>


<li>Вместо <nobr><tt class="type">struct in_addr</tt></nobr> используй <nobr><tt class="type">struct
in6_addr</tt></nobr>, убедись что в нужных местах приписал "6" к полям (см. <a href="ipstructsdata.html#structs"><nobr><tt class="type">struct</tt></nobr>ы</a> выше).</li>


<li>Вместо <b><tt class="func">inet_aton()</tt></b> or <b><tt class="func">inet_addr()</tt></b>, используй
<b><tt class="func">inet_pton()</tt></b>.</li>


<li>Instead of <b><tt class="func">inet_ntoa()</tt></b>, use
<b><tt class="func">inet_ntop()</tt></b>.</li>


<li>Instead of <b><tt class="func">gethostbyname()</tt></b>, use the superior
<b><tt class="func">getaddrinfo()</tt></b>.</li>


<li>Вместо <b><tt class="func">gethostbyaddr()</tt></b>, используй более мощный вызов <a name="indexId434909-90"></a><b><tt class="func">getnameinfo()</tt></b> (хоть <b><tt class="func">gethostbyaddr()</tt></b> и может работать с IPv6).</li>


<li><tt class="const">INADDR_BROADCAST</tt> более не работает. Вместо этого используй IPv6 multicast.</li>


</ol>


<p><i>Вперёд</i>!</p>

<table width="100%" border="0" cellspacing="0"cellpadding="0" class="navtable">
<tr>
<td align="left"><a href="ipstructsdata.html">&lt;&lt;&nbsp;Пред</a></td>
<td align="center"><a href="index.html">Руководство Beej'a по Программированию Сетей</a></td><td align="right"><a href="syscalls.html">След&nbsp;&gt;&gt;</a></td>
</tr></table>

</body>
</html>
